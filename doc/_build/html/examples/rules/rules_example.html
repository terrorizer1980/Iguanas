
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rules Example &#8212; Iguanas  documentation</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/blank.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/iguanas.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="shortcut icon" href="../../_static/iguanas_icon.png"/>
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Convert Processed Conditions to General Example" href="convert_processed_conditions_to_general_example.html" />
    <link rel="prev" title="Rules" href="index.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../index.html">
  <img src="../../_static/iguanas_text_logo.png" class="logo" alt="logo">
</a>      


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../install/index.html">
  Installation
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../user_guide/index.html">
  User Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../api/index.html">
  API
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../index.html">
  Examples
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../about_the_project/index.html">
  About the project
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/paypal/Iguanas" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../complete/index.html">
   Complete examples
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../complete/rbs_example.html">
     Rules-Based System (RBS) example
    </a>
   </li>
  </ul>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../correlation_reduction/index.html">
   Correlation Reduction
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../correlation_reduction/agglomerative_clustering_reducer_example.html">
     AgglomerativeClusteringReducer Example
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../metrics/index.html">
   Metrics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../metrics/classification_example.html">
     Classification Metrics Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../metrics/classification_spark_example.html">
     Classification Metrics Spark Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../metrics/pairwise_example.html">
     Pairwise Metrics Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../metrics/unsupervised_example.html">
     Unsupervised Metrics Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../metrics/unsupervised_spark_example.html">
     Unsupervised Metrics Spark Example
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../pipeline/index.html">
   Pipeline
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../pipeline/linear_pipeline_example.html">
     Linear Pipeline Example
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../rbs/index.html">
   Rules-Based System (RBS)
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../rbs/rbs_pipeline_example.html">
     Rule-Based System (RBS) Pipeline Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../rbs/rbs_optimiser_example.html">
     Rule-Based System (RBS) Optimiser Example
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../rule_application/index.html">
   Rule Application
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../rule_application/rule_applier_example.html">
     Rule Applier Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../rule_application/rule_applier_spark_example.html">
     Rule Applier Spark Example
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../rule_generation/index.html">
   Rule Generation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../rule_generation/rule_generator_dt_example.html">
     Rule Generator (Decision Tree algorithm) Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../rule_generation/rule_generator_dt_spark_example.html">
     Rule Generator (Decision Tree algorithm) Spark Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../rule_generation/rule_generator_opt_example.html">
     Rule Generator (Optimisation algorithm) Example
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../rule_optimisation/index.html">
   Rule Optimisation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../rule_optimisation/bayesian_optimiser_example.html">
     Bayesian Optimiser Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../rule_optimisation/bayesian_optimiser_unlabelled_example.html">
     Bayesian Optimiser (unlabelled) Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../rule_optimisation/direct_search_optimiser_example.html">
     Direct Search Optimiser Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../rule_optimisation/direct_search_optimiser_unlabelled_example.html">
     Direct Search Optimiser (unlabelled) Example
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../rule_scoring/index.html">
   Rule Scoring
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../rule_scoring/rule_scorer_example.html">
     Rule Scorer Example
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../rule_selection/index.html">
   Rule Selection
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../rule_selection/simple_filter_example.html">
     Simple Filter Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../rule_selection/correlated_filter_example.html">
     Correlated Filter Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../rule_selection/greedy_filter_example.html">
     Greedy Filter Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../rule_selection/bayes_search_cv_example.html">
     Bayes Search CV Example
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   Rules
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Rules Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="convert_processed_conditions_to_general_example.html">
     Convert Processed Conditions to General Example
    </a>
   </li>
  </ul>
 </li>
</ul>

  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Import-packages">
   Import packages
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Create-dummy-dataset">
   Create dummy dataset
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Instantiate-Rule-class">
   Instantiate Rule class
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Using-dictionary-representation">
     Using dictionary representation
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#Outputs">
       Outputs
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Using-string-representation">
     Using string representation
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Outputs
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Converting-to-lambda-expressions">
   Converting to lambda expressions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#with_kwargs-=-True">
     with_kwargs = True
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       Outputs
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#with_kwargs-=-False">
     with_kwargs = False
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id3">
       Outputs
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Filtering-rules">
   Filtering rules
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     Outputs
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Returning-the-features-in-each-rule">
   Returning the features in each rule
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     Outputs
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Applying-rules-to-a-dataset">
   Applying rules to a dataset
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id6">
     Outputs
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Rules-Example">
<h1>Rules Example<a class="headerlink" href="#Rules-Example" title="Permalink to this headline">¶</a></h1>
<p>The Rules class is used to define a set of rules using one of two representations. Once defined, we can switch between the different representations.</p>
<p>A rule set can be defined using one of the two following representations:</p>
<ul class="simple">
<li><p>Dictionary representation - here each joining condition (defined using the key <code class="docutils literal notranslate"><span class="pre">condition</span></code>) and each rule condition (defined using the keys <code class="docutils literal notranslate"><span class="pre">feature</span></code>, <code class="docutils literal notranslate"><span class="pre">operator</span></code> and <code class="docutils literal notranslate"><span class="pre">value</span></code>) of each rule are defined in a dictionary.</p></li>
<li><p>String representation - here each rule is defined using the Pandas syntax, stored as a string. Python’s built in <code class="docutils literal notranslate"><span class="pre">eval()</span></code> function can be used to evaluate the rule using this representation on a dataset.</p></li>
</ul>
<p>We can also convert either of the above representations to the lambda expression format. This format allows different values to be injected into the rule string, which can then be evaluated on a dataset. This is very useful for when we optimise existing rules on a dataset.</p>
<hr class="docutils" />
<div class="section" id="Import-packages">
<h2>Import packages<a class="headerlink" href="#Import-packages" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">iguanas.rules</span> <span class="kn">import</span> <span class="n">Rules</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Create-dummy-dataset">
<h2>Create dummy dataset<a class="headerlink" href="#Create-dummy-dataset" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s1">&#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span>
        <span class="s1">&#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span>
        <span class="s1">&#39;payer_id_sum_approved_txn_amt_per_paypalid_30day&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span>
        <span class="s1">&#39;num_items&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span>
        <span class="s1">&#39;ml_cc_v0&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span>
        <span class="s1">&#39;method_clean&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;checkout&#39;</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;bad_login&#39;</span><span class="p">,</span> <span class="s1">&#39;bad_checkout&#39;</span><span class="p">,</span> <span class="s1">&#39;fraud_login&#39;</span><span class="p">,</span> <span class="s1">&#39;fraud_checkout&#39;</span><span class="p">,</span> <span class="s1">&#39;signup&#39;</span><span class="p">,</span> <span class="s1">&#39;bad_signup&#39;</span><span class="p">,</span> <span class="s1">&#39;fraud_signup&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s1">&#39;ip_address&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;192.168.0.1&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span> <span class="o">*</span> <span class="mi">500</span><span class="p">,</span>
        <span class="s1">&#39;ip_isp&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;BT&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">250</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
</div>
<div class="section" id="Instantiate-Rule-class">
<h2>Instantiate Rule class<a class="headerlink" href="#Instantiate-Rule-class" title="Permalink to this headline">¶</a></h2>
<div class="section" id="Using-dictionary-representation">
<h3>Using dictionary representation<a class="headerlink" href="#Using-dictionary-representation" title="Permalink to this headline">¶</a></h3>
<p>As mentioned above, we can define a rule set using one of the two following representations - Dictionary or String.</p>
<p>Let’s first define a set of rules using the dictionary representation:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_dicts</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Rule1&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;condition&#39;</span><span class="p">:</span> <span class="s1">&#39;AND&#39;</span><span class="p">,</span>
        <span class="s1">&#39;rules&#39;</span><span class="p">:</span> <span class="p">[{</span>
            <span class="s1">&#39;condition&#39;</span><span class="p">:</span> <span class="s1">&#39;OR&#39;</span><span class="p">,</span>
            <span class="s1">&#39;rules&#39;</span><span class="p">:</span> <span class="p">[{</span>
                <span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;</span><span class="p">,</span>
                <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;greater_or_equal&#39;</span><span class="p">,</span>
                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mf">60.0</span>
            <span class="p">},</span>
                <span class="p">{</span>
                <span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;</span><span class="p">,</span>
                <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;greater&#39;</span><span class="p">,</span>
                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mf">120.0</span>
            <span class="p">},</span>
                <span class="p">{</span>
                <span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;payer_id_sum_approved_txn_amt_per_paypalid_30day&#39;</span><span class="p">,</span>
                <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;less_or_equal&#39;</span><span class="p">,</span>
                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mf">500.0</span>
            <span class="p">}</span>
            <span class="p">]},</span>
            <span class="p">{</span>
                <span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;num_items&#39;</span><span class="p">,</span>
            <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;equal&#39;</span><span class="p">,</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mf">1.0</span>
        <span class="p">}</span>
        <span class="p">]},</span>
    <span class="s1">&#39;Rule2&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;condition&#39;</span><span class="p">:</span> <span class="s1">&#39;AND&#39;</span><span class="p">,</span>
        <span class="s1">&#39;rules&#39;</span><span class="p">:</span> <span class="p">[{</span>
            <span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;ml_cc_v0&#39;</span><span class="p">,</span>
            <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;less&#39;</span><span class="p">,</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mf">0.315</span>
        <span class="p">},</span>
            <span class="p">{</span>
                <span class="s1">&#39;condition&#39;</span><span class="p">:</span> <span class="s1">&#39;OR&#39;</span><span class="p">,</span>
                <span class="s1">&#39;rules&#39;</span><span class="p">:</span> <span class="p">[{</span>
                    <span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;method_clean&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;equal&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;checkout&#39;</span>
                <span class="p">},</span>
                    <span class="p">{</span>
                    <span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;method_clean&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;begins_with&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;checkout&#39;</span>
                <span class="p">},</span>
                    <span class="p">{</span>
                    <span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;method_clean&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;ends_with&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;checkout&#39;</span>
                <span class="p">},</span>
                    <span class="p">{</span>
                    <span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;method_clean&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;contains&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;checkout&#39;</span>
                <span class="p">},</span>
                    <span class="p">{</span>
                    <span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;ip_address&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;is_not_null&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="kc">None</span>
                <span class="p">},</span>
                    <span class="p">{</span>
                    <span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;ip_isp&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;is_not_empty&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="kc">None</span>
                <span class="p">}]</span>
        <span class="p">}]</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Now that we have defined our rule set using the dictionary representation, we can instantiate the <code class="docutils literal notranslate"><span class="pre">Rules</span></code> class.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rules</span> <span class="o">=</span> <span class="n">Rules</span><span class="p">(</span><span class="n">rule_dicts</span><span class="o">=</span><span class="n">rule_dicts</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Once the class is instantiated, we can switch to the string representation using the <code class="docutils literal notranslate"><span class="pre">as_rule_strings</span></code> method:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_strings</span> <span class="o">=</span> <span class="n">rules</span><span class="o">.</span><span class="n">as_rule_strings</span><span class="p">(</span><span class="n">as_numpy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Outputs">
<h4>Outputs<a class="headerlink" href="#Outputs" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">as_rule_strings</span></code> method returns a dictionary of the set of rules defined using the standard Iguanas string format (values) and their names (keys). It also saves this dictionary as the class attribute <code class="docutils literal notranslate"><span class="pre">rule_strings</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_strings</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;Rule1&#39;: &#34;((X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;]&gt;=60.0)|(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;]&gt;120.0)|(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_30day&#39;]&lt;=500.0))&amp;(X[&#39;num_items&#39;]==1.0)&#34;,
 &#39;Rule2&#39;: &#34;(X[&#39;ml_cc_v0&#39;]&lt;0.315)&amp;((X[&#39;method_clean&#39;]==&#39;checkout&#39;)|(X[&#39;method_clean&#39;].str.startswith(&#39;checkout&#39;, na=False))|(X[&#39;method_clean&#39;].str.endswith(&#39;checkout&#39;, na=False))|(X[&#39;method_clean&#39;].str.contains(&#39;checkout&#39;, na=False, regex=False))|(~X[&#39;ip_address&#39;].isna())|(X[&#39;ip_isp&#39;].fillna(&#39;&#39;)!=&#39;&#39;))&#34;}
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Using-string-representation">
<h3>Using string representation<a class="headerlink" href="#Using-string-representation" title="Permalink to this headline">¶</a></h3>
<p>Now let’s instead define the same set of rules using the string representation:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_strings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Rule1&#39;</span><span class="p">:</span> <span class="s2">&quot;((X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;]&gt;=60.0)|(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;]&gt;120.0)|(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_30day&#39;]&lt;=500.0))&amp;(X[&#39;num_items&#39;]==1.0)&quot;</span><span class="p">,</span>
    <span class="s1">&#39;Rule2&#39;</span><span class="p">:</span> <span class="s2">&quot;(X[&#39;ml_cc_v0&#39;]&lt;0.315)&amp;((X[&#39;method_clean&#39;]==&#39;checkout&#39;)|(X[&#39;method_clean&#39;].str.startswith(&#39;checkout&#39;, na=False))|(X[&#39;method_clean&#39;].str.endswith(&#39;checkout&#39;, na=False))|(X[&#39;method_clean&#39;].str.contains(&#39;checkout&#39;, na=False))|(~X[&#39;ip_address&#39;].isna())|(X[&#39;ip_isp&#39;].fillna(&#39;&#39;)!=&#39;&#39;))&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Now that we have defined our rule set using the string representation, we can instantiate the <code class="docutils literal notranslate"><span class="pre">Rules</span></code> class.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rules</span> <span class="o">=</span> <span class="n">Rules</span><span class="p">(</span><span class="n">rule_strings</span><span class="o">=</span><span class="n">rule_strings</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Once the class is instantiated, we can switch to the dictionary representation using the <code class="docutils literal notranslate"><span class="pre">as_rule_dicts</span></code> method:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_dicts</span> <span class="o">=</span> <span class="n">rules</span><span class="o">.</span><span class="n">as_rule_dicts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h4>Outputs<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">as_rule_dicts</span></code> method returns a dictionary of the set of rules defined using the standard Iguanas dictionary format (values) and their names (keys). It also saves this dictionary as the class attribute <code class="docutils literal notranslate"><span class="pre">rule_dicts</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_dicts</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;Rule1&#39;: {&#39;condition&#39;: &#39;AND&#39;,
  &#39;rules&#39;: [{&#39;condition&#39;: &#39;OR&#39;,
    &#39;rules&#39;: [{&#39;field&#39;: &#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;,
      &#39;operator&#39;: &#39;greater_or_equal&#39;,
      &#39;value&#39;: 60.0},
     {&#39;field&#39;: &#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;,
      &#39;operator&#39;: &#39;greater&#39;,
      &#39;value&#39;: 120.0},
     {&#39;field&#39;: &#39;payer_id_sum_approved_txn_amt_per_paypalid_30day&#39;,
      &#39;operator&#39;: &#39;less_or_equal&#39;,
      &#39;value&#39;: 500.0}]},
   {&#39;field&#39;: &#39;num_items&#39;, &#39;operator&#39;: &#39;equal&#39;, &#39;value&#39;: 1.0}]},
 &#39;Rule2&#39;: {&#39;condition&#39;: &#39;AND&#39;,
  &#39;rules&#39;: [{&#39;field&#39;: &#39;ml_cc_v0&#39;, &#39;operator&#39;: &#39;less&#39;, &#39;value&#39;: 0.315},
   {&#39;condition&#39;: &#39;OR&#39;,
    &#39;rules&#39;: [{&#39;field&#39;: &#39;method_clean&#39;,
      &#39;operator&#39;: &#39;equal&#39;,
      &#39;value&#39;: &#39;checkout&#39;},
     {&#39;field&#39;: &#39;method_clean&#39;, &#39;operator&#39;: &#39;begins_with&#39;, &#39;value&#39;: &#39;checkout&#39;},
     {&#39;field&#39;: &#39;method_clean&#39;, &#39;operator&#39;: &#39;ends_with&#39;, &#39;value&#39;: &#39;checkout&#39;},
     {&#39;field&#39;: &#39;method_clean&#39;, &#39;operator&#39;: &#39;contains&#39;, &#39;value&#39;: &#39;checkout&#39;},
     {&#39;field&#39;: &#39;ip_address&#39;, &#39;operator&#39;: &#39;is_not_null&#39;, &#39;value&#39;: None},
     {&#39;field&#39;: &#39;ip_isp&#39;, &#39;operator&#39;: &#39;is_not_empty&#39;, &#39;value&#39;: None}]}]}}
</pre></div></div>
</div>
<hr class="docutils" />
</div>
</div>
</div>
<div class="section" id="Converting-to-lambda-expressions">
<h2>Converting to lambda expressions<a class="headerlink" href="#Converting-to-lambda-expressions" title="Permalink to this headline">¶</a></h2>
<p>Once a rule set has been defined using one of the two representations, it can be converted to the lambda expression format. This format allows different values to be injected into the rule string, which can then be evaluated on a dataset. This is very useful for when we optimise existing rules on a dataset.</p>
<p>We can use the above instantiated Rules class along with the <code class="docutils literal notranslate"><span class="pre">as_rule_lambdas</span></code> method to convert the rules to the lambda expression format. The lambda expressions can be created such that they receive either keyword arguments as inputs, or positional arguments as inputs.</p>
<div class="section" id="with_kwargs-=-True">
<h3>with_kwargs = True<a class="headerlink" href="#with_kwargs-=-True" title="Permalink to this headline">¶</a></h3>
<p>Let’s first convert the rule set to lambda expressions that receive keyword arguments as inputs:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_lambdas</span> <span class="o">=</span> <span class="n">rules</span><span class="o">.</span><span class="n">as_rule_lambdas</span><span class="p">(</span>
    <span class="n">as_numpy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">with_kwargs</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h4>Outputs<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">as_rule_lambdas</span></code> method returns a dictionary of the set of rules defined using the standard Iguanas lambda expression format (values) and their names (keys). It also saves this dictionary as the class attribute <code class="docutils literal notranslate"><span class="pre">rule_lambdas</span></code>.</p>
<p>Three useful attributes created by running the <code class="docutils literal notranslate"><span class="pre">as_rule_lambdas</span></code> method are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">lambda_kwargs</span></code> (dict): For each rule (keys), a dictionary containing the features used in the rule (keys) and the current values (values). Only populates when <code class="docutils literal notranslate"><span class="pre">as_rule_lambdas</span></code> is used with the keyword argument <code class="docutils literal notranslate"><span class="pre">with_kwargs</span></code>=True.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lambda_args</span></code> (dict): For each rule (keys), a list containing the current values used in the rule. Only populates when <code class="docutils literal notranslate"><span class="pre">as_rule_lambdas</span></code> is used with the keyword argument <code class="docutils literal notranslate"><span class="pre">with_kwargs</span></code>=False.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rule_features</span></code> (dict): For each rule (keys), a list containing the features used in the rule. Only populates when <code class="docutils literal notranslate"><span class="pre">as_rule_lambdas</span></code> is used with the keyword argument <code class="docutils literal notranslate"><span class="pre">with_kwargs</span></code>=False.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_lambdas</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;Rule1&#39;: &lt;function iguanas.rules._convert_rule_dicts_to_rule_strings._ConvertRuleDictsToRuleStrings._convert_to_lambda.&lt;locals&gt;._make_lambda.&lt;locals&gt;.&lt;lambda&gt;(**kwargs)&gt;,
 &#39;Rule2&#39;: &lt;function iguanas.rules._convert_rule_dicts_to_rule_strings._ConvertRuleDictsToRuleStrings._convert_to_lambda.&lt;locals&gt;._make_lambda.&lt;locals&gt;.&lt;lambda&gt;(**kwargs)&gt;}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rules</span><span class="o">.</span><span class="n">lambda_kwargs</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;Rule1&#39;: {&#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;: 60.0,
  &#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;: 120.0,
  &#39;payer_id_sum_approved_txn_amt_per_paypalid_30day&#39;: 500.0,
  &#39;num_items&#39;: 1.0},
 &#39;Rule2&#39;: {&#39;ml_cc_v0&#39;: 0.315}}
</pre></div></div>
</div>
<p>Across both rules, we have the following features:</p>
<ul class="simple">
<li><p>payer_id_sum_approved_txn_amt_per_paypalid_1day</p></li>
<li><p>payer_id_sum_approved_txn_amt_per_paypalid_7day</p></li>
<li><p>payer_id_sum_approved_txn_amt_per_paypalid_30day</p></li>
<li><p>num_items</p></li>
<li><p>ml_cc_v0</p></li>
<li><p>method_clean</p></li>
<li><p>ip_address</p></li>
<li><p>ip_isp</p></li>
</ul>
<p><strong>A few points to note:</strong></p>
<ul class="simple">
<li><p>When the same feature is used more than once in a given rule, a suffix with the format ‘%&lt;n&gt;’ will be added, where <em>n</em> is a counter used to distinguish the conditions.</p></li>
<li><p>The values of some of these features cannot be changed, since the conditions related to these features do not have values - ‘ip_address’ is checked for nulls and ‘ip_isp’ is checked for empty cells. These are omitted from the <code class="docutils literal notranslate"><span class="pre">lambda_kwargs</span></code> class attribute (as seen above).</p></li>
</ul>
<p>So we can construct a dictionary for each rule, for the features whose values can be changed. The keys of each dictionary are the features, with the values being the new values that we want to try in the rule:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">new_values</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Rule1&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;</span><span class="p">:</span> <span class="mf">100.0</span><span class="p">,</span>
        <span class="s1">&#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;</span><span class="p">:</span> <span class="mf">200.0</span><span class="p">,</span>
        <span class="s1">&#39;payer_id_sum_approved_txn_amt_per_paypalid_30day&#39;</span><span class="p">:</span> <span class="mf">600.0</span><span class="p">,</span>
        <span class="s1">&#39;num_items&#39;</span><span class="p">:</span> <span class="mf">2.0</span>
    <span class="p">},</span>
    <span class="s1">&#39;Rule2&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;ml_cc_v0&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="s1">&#39;method_clean&#39;</span><span class="p">:</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span>
        <span class="s1">&#39;method_clean%0&#39;</span><span class="p">:</span> <span class="s1">&#39;bad_&#39;</span><span class="p">,</span>
        <span class="s1">&#39;method_clean%1&#39;</span><span class="p">:</span> <span class="s1">&#39;_bad&#39;</span><span class="p">,</span>
        <span class="s1">&#39;method_clean%2&#39;</span><span class="p">:</span> <span class="s1">&#39;fraud&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Then we can loop through the rules, inject the new values into the lambda expression and evaluate it (with the new values) on the dataset:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_rules</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">rule_name</span><span class="p">,</span> <span class="n">rule_lambda</span> <span class="ow">in</span> <span class="n">rules</span><span class="o">.</span><span class="n">rule_lambdas</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">new_values_for_rule</span> <span class="o">=</span> <span class="n">new_values</span><span class="p">[</span><span class="n">rule_name</span><span class="p">]</span>
    <span class="n">X_rules</span><span class="p">[</span><span class="n">rule_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">rule_lambda</span><span class="p">(</span><span class="o">**</span><span class="n">new_values_for_rule</span><span class="p">))</span>
<span class="n">X_rules</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_rules</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_rules</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Rule1     99
Rule2    352
dtype: int64
</pre></div></div>
</div>
<p>We can also use the <code class="docutils literal notranslate"><span class="pre">lambda_kwargs</span></code> class attribute to inject the original values into the lambda expression and evaluate it on the dataset:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_rules</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">rule_name</span><span class="p">,</span> <span class="n">rule_lambda</span> <span class="ow">in</span> <span class="n">rules</span><span class="o">.</span><span class="n">rule_lambdas</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">X_rules</span><span class="p">[</span><span class="n">rule_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">rule_lambda</span><span class="p">(</span><span class="o">**</span><span class="n">rules</span><span class="o">.</span><span class="n">lambda_kwargs</span><span class="p">[</span><span class="n">rule_name</span><span class="p">]))</span>
<span class="n">X_rules</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_rules</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_rules</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Rule1     96
Rule2    233
dtype: int64
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="with_kwargs-=-False">
<h3>with_kwargs = False<a class="headerlink" href="#with_kwargs-=-False" title="Permalink to this headline">¶</a></h3>
<p>Now let’s convert the rule set to lambda expressions that receive positions arguments as inputs:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_lambdas</span> <span class="o">=</span> <span class="n">rules</span><span class="o">.</span><span class="n">as_rule_lambdas</span><span class="p">(</span>
    <span class="n">as_numpy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">with_kwargs</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h4>Outputs<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">as_rule_lambdas</span></code> method returns a dictionary of the set of rules defined using the standard Iguanas lambda expression format (values) and their names (keys). It also saves this dictionary as the class attribute <em>rule_lambdas</em>.</p>
<p>Three useful attributes created by running the <code class="docutils literal notranslate"><span class="pre">as_rule_lambdas</span></code> method are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">lambda_kwargs</span></code> (dict): For each rule (keys), a dictionary containing the features used in the rule (keys) and the current values (values). Only populates when <code class="docutils literal notranslate"><span class="pre">as_rule_lambdas</span></code> is used with the keyword argument <code class="docutils literal notranslate"><span class="pre">with_kwargs</span></code>=True.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lambda_args</span></code> (dict): For each rule (keys), a list containing the current values used in the rule. Only populates when <code class="docutils literal notranslate"><span class="pre">as_rule_lambdas</span></code> is used with the keyword argument <code class="docutils literal notranslate"><span class="pre">with_kwargs</span></code>=False.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rule_features</span></code> (dict): For each rule (keys), a list containing the features used in the rule. Only populates when <code class="docutils literal notranslate"><span class="pre">as_rule_lambdas</span></code> is used with the keyword argument <code class="docutils literal notranslate"><span class="pre">with_kwargs</span></code>=False.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_lambdas</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;Rule1&#39;: &lt;function iguanas.rules._convert_rule_dicts_to_rule_strings._ConvertRuleDictsToRuleStrings._convert_to_lambda.&lt;locals&gt;._make_lambda.&lt;locals&gt;.&lt;lambda&gt;(*args)&gt;,
 &#39;Rule2&#39;: &lt;function iguanas.rules._convert_rule_dicts_to_rule_strings._ConvertRuleDictsToRuleStrings._convert_to_lambda.&lt;locals&gt;._make_lambda.&lt;locals&gt;.&lt;lambda&gt;(*args)&gt;}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rules</span><span class="o">.</span><span class="n">lambda_args</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;Rule1&#39;: [60.0, 120.0, 500.0, 1.0], &#39;Rule2&#39;: [0.315]}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rules</span><span class="o">.</span><span class="n">rule_features</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;Rule1&#39;: [&#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;,
  &#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;,
  &#39;payer_id_sum_approved_txn_amt_per_paypalid_30day&#39;,
  &#39;num_items&#39;],
 &#39;Rule2&#39;: [&#39;ml_cc_v0&#39;]}
</pre></div></div>
</div>
<p>Across both rules, we have the following features:</p>
<ul class="simple">
<li><p>payer_id_sum_approved_txn_amt_per_paypalid_1day</p></li>
<li><p>payer_id_sum_approved_txn_amt_per_paypalid_7day</p></li>
<li><p>payer_id_sum_approved_txn_amt_per_paypalid_30day</p></li>
<li><p>num_items</p></li>
<li><p>ml_cc_v0</p></li>
<li><p>method_clean</p></li>
<li><p>ip_address</p></li>
<li><p>ip_isp</p></li>
</ul>
<p><strong>Note:</strong> the values of some of these features cannot be changed, since the conditions related to these features do not have values - ‘ip_address’ is checked for nulls and ‘ip_isp’ is checked for empty cells. These are omitted from the <code class="docutils literal notranslate"><span class="pre">lambda_args</span></code> class attribute (as seen above).</p>
<p>So we can construct a list for each rule, for the features whose values can be changed. The values of the list are new values that we want to try in the rules. We can use the <code class="docutils literal notranslate"><span class="pre">rule_features</span></code> class attribute to ensure we use the correct order:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">new_values</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Rule1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">,</span> <span class="mf">600.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span>
    <span class="s1">&#39;Rule2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;bad_&#39;</span><span class="p">,</span> <span class="s1">&#39;_bad&#39;</span><span class="p">,</span> <span class="s1">&#39;fraud&#39;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Then we can loop through the rules, inject the new values into the lambda expression and evaluate it (with the new values) on the dataset:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_rules</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">rule_name</span><span class="p">,</span> <span class="n">rule_lambda</span> <span class="ow">in</span> <span class="n">rules</span><span class="o">.</span><span class="n">rule_lambdas</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">new_values_for_rule</span> <span class="o">=</span> <span class="n">new_values</span><span class="p">[</span><span class="n">rule_name</span><span class="p">]</span>
    <span class="n">X_rules</span><span class="p">[</span><span class="n">rule_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">rule_lambda</span><span class="p">(</span><span class="o">*</span><span class="n">new_values_for_rule</span><span class="p">))</span>
<span class="n">X_rules</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_rules</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_rules</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Rule1     99
Rule2    352
dtype: int64
</pre></div></div>
</div>
<p>We can also use the <code class="docutils literal notranslate"><span class="pre">lambda_args</span></code> class attribute to inject the original values into the lambda expression and evaluate it on the dataset:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_rules</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">rule_name</span><span class="p">,</span> <span class="n">rule_lambda</span> <span class="ow">in</span> <span class="n">rules</span><span class="o">.</span><span class="n">rule_lambdas</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">X_rules</span><span class="p">[</span><span class="n">rule_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">rule_lambda</span><span class="p">(</span><span class="o">*</span><span class="n">rules</span><span class="o">.</span><span class="n">lambda_args</span><span class="p">[</span><span class="n">rule_name</span><span class="p">]))</span>
<span class="n">X_rules</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_rules</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_rules</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Rule1     96
Rule2    233
dtype: int64
</pre></div></div>
</div>
<hr class="docutils" />
</div>
</div>
</div>
<div class="section" id="Filtering-rules">
<h2>Filtering rules<a class="headerlink" href="#Filtering-rules" title="Permalink to this headline">¶</a></h2>
<p>We can use the <code class="docutils literal notranslate"><span class="pre">filter_rules</span></code> method to filter a ruleset based on their names. Let’s say we define the following rule set, which consists of three rules:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_strings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Rule1&#39;</span><span class="p">:</span> <span class="s2">&quot;(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;]&gt;=60.0)&quot;</span><span class="p">,</span>
    <span class="s1">&#39;Rule2&#39;</span><span class="p">:</span> <span class="s2">&quot;(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;]&gt;120.0)&quot;</span><span class="p">,</span>
    <span class="s1">&#39;Rule3&#39;</span><span class="p">:</span> <span class="s2">&quot;(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_30day&#39;]&lt;=500.0)&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rules</span> <span class="o">=</span> <span class="n">Rules</span><span class="p">(</span><span class="n">rule_strings</span><span class="o">=</span><span class="n">rule_strings</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rules</span><span class="o">.</span><span class="n">rule_strings</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;Rule1&#39;: &#34;(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;]&gt;=60.0)&#34;,
 &#39;Rule2&#39;: &#34;(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;]&gt;120.0)&#34;,
 &#39;Rule3&#39;: &#34;(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_30day&#39;]&lt;=500.0)&#34;}
</pre></div></div>
</div>
<p>Now we can filter the rule set to include or exclude those rules stated:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rules</span><span class="o">.</span><span class="n">filter_rules</span><span class="p">(</span>
    <span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Rule1&#39;</span><span class="p">],</span>
    <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h3>Outputs<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">filter_rules</span></code> method does not return a value, however it does filter the rules within the class, based on the rules that were included or excluded:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rules</span><span class="o">.</span><span class="n">rule_strings</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;Rule1&#39;: &#34;(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;]&gt;=60.0)&#34;}
</pre></div></div>
</div>
<hr class="docutils" />
</div>
</div>
<div class="section" id="Returning-the-features-in-each-rule">
<h2>Returning the features in each rule<a class="headerlink" href="#Returning-the-features-in-each-rule" title="Permalink to this headline">¶</a></h2>
<p>We can use the <code class="docutils literal notranslate"><span class="pre">get_rule_features</span></code> method to return the unique set of features related to each rule. Let’s say we define the following rule set, which consists of three rules:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_strings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Rule1&#39;</span><span class="p">:</span> <span class="s2">&quot;(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;]&gt;=60.0)&amp;(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;]&gt;120.0)&quot;</span><span class="p">,</span>
    <span class="s1">&#39;Rule2&#39;</span><span class="p">:</span> <span class="s2">&quot;(X[&#39;num_order_items&#39;]&gt;20)|((X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;]&lt;100.0)&amp;(X[&#39;num_order_items&#39;]&gt;10))&quot;</span><span class="p">,</span>
    <span class="s1">&#39;Rule3&#39;</span><span class="p">:</span> <span class="s2">&quot;(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_30day&#39;]&lt;=500.0)&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rules</span> <span class="o">=</span> <span class="n">Rules</span><span class="p">(</span><span class="n">rule_strings</span><span class="o">=</span><span class="n">rule_strings</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now we can return the unique set of features related to each rule:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_features</span> <span class="o">=</span> <span class="n">rules</span><span class="o">.</span><span class="n">get_rule_features</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3>Outputs<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">get_rule_features</span></code> method return a dictionary of the unique set of features (values) related to each rule (keys):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_features</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;Rule1&#39;: {&#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;,
  &#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;},
 &#39;Rule2&#39;: {&#39;num_order_items&#39;,
  &#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;},
 &#39;Rule3&#39;: {&#39;payer_id_sum_approved_txn_amt_per_paypalid_30day&#39;}}
</pre></div></div>
</div>
<hr class="docutils" />
</div>
</div>
<div class="section" id="Applying-rules-to-a-dataset">
<h2>Applying rules to a dataset<a class="headerlink" href="#Applying-rules-to-a-dataset" title="Permalink to this headline">¶</a></h2>
<p>Use the <code class="docutils literal notranslate"><span class="pre">transform</span></code> method to apply the rules to a dataset:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rule_strings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Rule1&#39;</span><span class="p">:</span> <span class="s2">&quot;(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_1day&#39;]&gt;=60.0)&amp;(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;]&gt;120.0)&quot;</span><span class="p">,</span>
    <span class="s1">&#39;Rule2&#39;</span><span class="p">:</span> <span class="s2">&quot;(X[&#39;num_items&#39;]&gt;20)|((X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_7day&#39;]&lt;100.0)&amp;(X[&#39;num_items&#39;]&gt;10))&quot;</span><span class="p">,</span>
    <span class="s1">&#39;Rule3&#39;</span><span class="p">:</span> <span class="s2">&quot;(X[&#39;payer_id_sum_approved_txn_amt_per_paypalid_30day&#39;]&lt;=500.0)&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rules</span> <span class="o">=</span> <span class="n">Rules</span><span class="p">(</span><span class="n">rule_strings</span><span class="o">=</span><span class="n">rule_strings</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_rules</span> <span class="o">=</span> <span class="n">rules</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h3>Outputs<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">transform</span></code> method returns a dataframe giving the binary columns of the rules as applied to the given dataset:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_rules</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rule1</th>
      <th>Rule2</th>
      <th>Rule3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<hr class="docutils" />
</div>
</div>
</div>


              </div>
              
              
          </main>
          

      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2021, James Laidler.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.3.1.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>